stages:
  - build

default:
  tags:
    - thehivehook_go

build-job:
  stage: build
  rules:
    - if: $CI_COMMIT_REF_NAME == "master"
      changes:
        - README.md
      when: never
#      refs:
#      - master
#      - latest        
#  only:
#    refs:
#      - master
#      - latest
#  except:

  before_script:
    - echo "Current URL repository - $CI_REPOSITORY_URL"
  script: 
    - pwd
    - docker-compose -f $CI_PROJECT_DIR/docker-compose.yml down 
    - docker rmi gitlab.cloud.gcm:5050/a.belyakov/thehivehook_go_package
    - docker-compose -f $CI_PROJECT_DIR/docker-compose.yml up -d --force-recreate --build